@model IEnumerable<Pixeria.Models.Dokument>
@{
    ViewBag.Title = "Home Page";
    var ImageExtensions = new List<string> { ".jpg", ".jpe", ".bmp", ".gif", ".png" };
    var liked = false;
}
<div class="panel-body">
    <div class="bs-example"
         data-example-id="thumbnails-with-custom-content">
        <div class="row">
            @foreach (var item in Model)
            {
                <div class="col-md-offset-2 col-md-8">
                    <div class="thumbnail">
                        @if (ImageExtensions.Contains(Path.GetExtension(item.Pfad).ToLower()))
                        {
                            <img src="@item.Pfad" alt="@item.Titel" id="img" onclick="showDokumentInfo(@item.Id)">
                        }
                        else
                        {
                            <video src="@item.Pfad" controls loop style="width:100%;height:100%">
                                Ihr Browser kann dieses Video nicht wiedergeben.
                                <br />
                                Dieser Film zeigt eine Demonstration des video-Elements.
                                Sie können ihn unter
                                <a href="#">Link-Addresse</a> abrufen.
                            </video>
                        }
                        @if (Session["user"] != null)
                        {
                            <div class="caption">
                                <h3>@item.Titel</h3>
                                <p>
                                    <a href="#" onclick="likeDokument(@item.Id)" class="btn btn-primary" role="button">
                                        @{liked = false;
                                            foreach (var like in item.Like)
                                            {
                                                if (like.User.Username == Session["user"].ToString())
                                                {
                                                    liked = true;
                                                }
                                            }
                                            if (liked)
                                            {
                                                <span id="like"+@item.Id class="glyphicon glyphicon-heart" aria-hidden="true"></span>
                                            }
                                            else
                                            {
                                                <span id="like"+@item.Id class="glyphicon glyphicon-heart-empty" aria-hidden="true"></span>
                                            }
                                        }
                                    </a> <a href="#" class="btn btn-default" role="button">Kommentieren</a>
                                </p>
                            </div>
                                            }
                    </div>
                </div>
                                            }
        </div>
    </div>
</div>
<script>
    function showDokumentInfo(id) {
        var url = '@Url.Action("Details", "Dokument", new { id = "__id__" })';
        window.location.href = url.replace('__id__', id);
    }
    function likeDokument(id) {
         $.ajax({
        url: "@Url.Action("Like", "Dokument")",
             type: "POST",
             dataType: "json",
            data: {
                id:id
            },
            error: function (response) {
                if (!response.Success)
                    alert("Like Fehlgeschlagen");
            },
            success: function (response) {
                if (response == 'New') {
                $("#row").load(document.URL + "#row");
                    $("like"+id).html="<span id='like'+id class='glyphicon glyphicon-heart' aria-hidden='true'></span>"
                }
                else if (response == 'Del')
                    $("like" + id).html = "<span id='like'+id class='glyphicon glyphicon-heart-empty' aria-hidden='true'></span>"
            }
        });
        @*var url = '@Url.Action("Like", "Dokument", new { id = "__id__" })';
        window.location.href = url.replace('__id__', id);*@
    }
</script>
